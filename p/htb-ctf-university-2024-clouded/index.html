<!doctype html><html lang=en-us dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Fullpwn - Clouded In the lawless expanse of the Frontier Cluster, Clouded emerges as a beacon of efficiency and security for file sharing. Breakthrough their cloud servers to obtain the secrets to finding the Starry Spur. Allow up to 1 minute for all the services to properly boot.\nUser Enumeration Upon scanning the ports, we found that port 22 and 80 are open.\nwhen try to access the port 80, it was redirected into clouded.htb. We try to enumerate subdomain using ffuf command below, and found other subdomain named local.clouded.htb "><title>[HTB CTF University 2024] - Clouded</title>
<link rel=canonical href=https://blog.lordrukie.com/p/htb-ctf-university-2024-clouded/><link rel=stylesheet href=/scss/style.min.663803bebe609202d5b39d848f2d7c2dc8b598a2d879efa079fa88893d29c49c.css><meta property='og:title' content="[HTB CTF University 2024] - Clouded"><meta property='og:description' content="Fullpwn - Clouded In the lawless expanse of the Frontier Cluster, Clouded emerges as a beacon of efficiency and security for file sharing. Breakthrough their cloud servers to obtain the secrets to finding the Starry Spur. Allow up to 1 minute for all the services to properly boot.\nUser Enumeration Upon scanning the ports, we found that port 22 and 80 are open.\nwhen try to access the port 80, it was redirected into clouded.htb. We try to enumerate subdomain using ffuf command below, and found other subdomain named local.clouded.htb "><meta property='og:url' content='https://blog.lordrukie.com/p/htb-ctf-university-2024-clouded/'><meta property='og:site_name' content='lordrukie'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:published_time' content='2024-12-18T22:16:07+07:00'><meta property='article:modified_time' content='2024-12-18T16:40:42+00:00'><meta property='og:image' content='https://blog.lordrukie.com/p/htb-ctf-university-2024-clouded/banner.png'><meta name=twitter:title content="[HTB CTF University 2024] - Clouded"><meta name=twitter:description content="Fullpwn - Clouded In the lawless expanse of the Frontier Cluster, Clouded emerges as a beacon of efficiency and security for file sharing. Breakthrough their cloud servers to obtain the secrets to finding the Starry Spur. Allow up to 1 minute for all the services to properly boot.\nUser Enumeration Upon scanning the ports, we found that port 22 and 80 are open.\nwhen try to access the port 80, it was redirected into clouded.htb. We try to enumerate subdomain using ffuf command below, and found other subdomain named local.clouded.htb "><meta name=twitter:card content="summary_large_image"><meta name=twitter:image content='https://blog.lordrukie.com/p/htb-ctf-university-2024-clouded/banner.png'><link rel="shortcut icon" href=/favicon.png></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Toggle Menu">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/><img src=/img/avatar_hu5923991180728147624.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>ðŸ˜¼</span></figure><div class=site-meta><h1 class=site-name><a href=/>lordrukie</a></h1><h2 class=site-description>Cyber Security Consultant | CTF Player</h2></div></header><ol class=menu-social><li><a href=https://github.com/lordrukie target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li><li><a href=https://x.com/belugagemink target=_blank title=Twitter rel=me><svg class="icon icon-tabler icon-tabler-brand-twitter" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M22 4.01c-1 .49-1.98.689-3 .99-1.121-1.265-2.783-1.335-4.38-.737S11.977 6.323 12 8v1c-3.245.083-6.135-1.395-8-4 0 0-4.182 7.433 4 11-1.872 1.247-3.739 2.088-6 2 3.308 1.803 6.913 2.423 10.034 1.517 3.58-1.04 6.522-3.723 7.651-7.742a13.84 13.84.0 00.497-3.753C20.18 7.773 21.692 5.25 22 4.009z"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/whoami/><svg class="icon icon-tabler icon-tabler-user" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="7" r="4"/><path d="M6 21v-2a4 4 0 014-4h4a4 4 0 014 4v2"/></svg>
<span>Whoami</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Dark Mode</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Table of contents</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#fullpwn---clouded>Fullpwn - Clouded</a></li><li><a href=#user>User</a><ol><li><a href=#enumeration>Enumeration</a></li><li><a href=#web-application>Web application</a></li><li><a href=#cloud-instances>Cloud instances</a></li><li><a href=#ssh-bruteforce>SSH Bruteforce</a></li></ol></li><li><a href=#root>Root</a><ol><li><a href=#ansible-playbook-rce>ansible-playbook rce</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class="has-image main-article"><header class=article-header><div class=article-image><a href=/p/htb-ctf-university-2024-clouded/><img src=/p/htb-ctf-university-2024-clouded/banner.png width=1861 height=712 loading=lazy alt="Featured image of post [HTB CTF University 2024] - Clouded"></a></div><div class=article-details><header class=article-category><a href=/categories/fullpwn/>Fullpwn
</a><a href=/categories/cloud/>Cloud</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/p/htb-ctf-university-2024-clouded/>[HTB CTF University 2024] - Clouded</a></h2></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published>Dec 18, 2024</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>3 minute read</time></div></footer></div></header><section class=article-content><h2 id=fullpwn---clouded>Fullpwn - Clouded</h2><blockquote><p>In the lawless expanse of the Frontier Cluster, Clouded emerges as a beacon of efficiency and security for file sharing. Breakthrough their cloud servers to obtain the secrets to finding the Starry Spur. Allow up to 1 minute for all the services to properly boot.</p></blockquote><h2 id=user>User</h2><h3 id=enumeration>Enumeration</h3><p>Upon scanning the ports, we found that port 22 and 80 are open.</p><p>when try to access the port 80, it was redirected into <code>clouded.htb</code>. We try to enumerate subdomain using ffuf command below, and found other subdomain named <code>local.clouded.htb</code>
<img src=/p/htb-ctf-university-2024-clouded/image.png width=1104 height=577 loading=lazy class=gallery-image data-flex-grow=191 data-flex-basis=459px></p><p>we add those two hostnames into <code>/etc/hosts</code>.</p><h3 id=web-application>Web application</h3><p><img src=/p/htb-ctf-university-2024-clouded/image-1.png width=1920 height=941 loading=lazy class=gallery-image data-flex-grow=204 data-flex-basis=489px>
The web page have several page, but the intersting one is <code>Upload</code> page. It allows user to upload several type of content.
<img src=/p/htb-ctf-university-2024-clouded/image-2.png width=879 height=673 loading=lazy class=gallery-image data-flex-grow=130 data-flex-basis=313px></p><p>If we try to upload any content, it will return uploaded file location from <code>local.clouded.htb</code> subdomain.
<img src=/p/htb-ctf-university-2024-clouded/image-3.png width=1138 height=823 loading=lazy class=gallery-image data-flex-grow=138 data-flex-basis=331px></p><h3 id=cloud-instances>Cloud instances</h3><p>Using curl, i was able to identify that the site was hosted using aws, probably an s3 bucket
<img src=/p/htb-ctf-university-2024-clouded/image-4.png width=842 height=591 loading=lazy class=gallery-image data-flex-grow=142 data-flex-basis=341px></p><p>I try to use <code>aws-cli</code> to enumerate the instances further, however i got permission denied
<img src=/p/htb-ctf-university-2024-clouded/image-5.png width=822 height=291 loading=lazy class=gallery-image data-flex-grow=282 data-flex-basis=677px></p><p>i then try to enumerate further, started with directory enumration. I found that the application accept urlencoded form of <code>?</code>.
<img src=/p/htb-ctf-university-2024-clouded/image-6.png width=1105 height=411 loading=lazy class=gallery-image data-flex-grow=268 data-flex-basis=645px></p><p>and after playing with other character, i noticed that the site also vulnerable to directory traversal, which allow me to bypass the restriction and access the bucket.
<img src=/p/htb-ctf-university-2024-clouded/image-7.png width=636 height=162 loading=lazy class=gallery-image data-flex-grow=392 data-flex-basis=942px></p><p>it have file named <code>backup.db</code> which can be downloaded directly using link below
<code>http://local.clouded.htb/uploads/..%2F/clouded-internal/backup.db</code></p><p><img src=/p/htb-ctf-university-2024-clouded/image-8.png width=830 height=89 loading=lazy class=gallery-image data-flex-grow=932 data-flex-basis=2238px></p><p>the backup contains a lot of name and password in md5 format.
<img src=/p/htb-ctf-university-2024-clouded/image-9.png width=1424 height=938 loading=lazy class=gallery-image data-flex-grow=151 data-flex-basis=364px></p><h3 id=ssh-bruteforce>SSH Bruteforce</h3><p>i managed to crack all the password and proceeding to create wordlists based on available information.</p><p>i&rsquo;ve tried multiple username combination based on <a class=link href=https://github.com/urbanadventurer/username-anarchy target=_blank rel=noopener>username-anarchy</a>. but in the end, the pair was simple. It was lastname:password.</p><p>I managed to obtain correct credentials, which was <code>nagato:alicia</code></p><p><img src=/p/htb-ctf-university-2024-clouded/image-10.png width=1102 height=263 loading=lazy class=gallery-image data-flex-grow=419 data-flex-basis=1005px></p><p>flag was located in <code>/home/nagato/flag.txt</code></p><p><img src=/p/htb-ctf-university-2024-clouded/image-11.png width=297 height=122 loading=lazy class=gallery-image data-flex-grow=243 data-flex-basis=584px></p><h2 id=root>Root</h2><p>After obtaining low privilege user, i try to enumerate further. Aparently, <code>nagato</code> is part of <code>frontiers</code> group, which have access for <code>/opt/infra-setup</code>.
<img src=/p/htb-ctf-university-2024-clouded/image-12.png width=649 height=118 loading=lazy class=gallery-image data-flex-grow=550 data-flex-basis=1320px></p><p>It containing yml script, potentially used for healthcheck.
<img src=/p/htb-ctf-university-2024-clouded/image-13.png width=924 height=342 loading=lazy class=gallery-image data-flex-grow=270 data-flex-basis=648px></p><p>If we try to monitor any process using <a class=link href=https://github.com/DominicBreuker/pspy target=_blank rel=noopener>pspy</a>, then we can see that root user are running <code>ansible</code> using yml file mentioned before.
<img src=/p/htb-ctf-university-2024-clouded/image-14.png width=1321 height=223 loading=lazy class=gallery-image data-flex-grow=592 data-flex-basis=1421px></p><h3 id=ansible-playbook-rce>ansible-playbook rce</h3><p>Using script from <a class=link href=https://0xdf.gitlab.io/2021/11/13/htb-seal.html#shell-as-root target=_blank rel=noopener>0xdf</a>, we can gain command execution using following yml code. Note that i made modification because i was lazy to setup reverse shell in my windows machine lol.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-yml data-lang=yml><span class=line><span class=cl>- <span class=nt>hosts</span><span class=p>:</span><span class=w> </span><span class=l>localhost</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span><span class=nt>tasks</span><span class=p>:</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>  </span>- <span class=nt>name</span><span class=p>:</span><span class=w> </span><span class=l>rev</span><span class=w>
</span></span></span><span class=line><span class=cl><span class=w>    </span><span class=nt>shell</span><span class=p>:</span><span class=w> </span><span class=l>bash -c &#39;chmod u+s /bin/bash&#39;</span><span class=w>
</span></span></span></code></pre></td></tr></table></div></div><p>since we dont have write permission into <code>checkup.yml</code>, we can&rsquo;t modify the file directly. However since we have write permission on the directory itself, we can delete or rename the file into something else. This way, we can create new file with name of <code>checkup.yml</code> and inject the malicious script.
<img src=/p/htb-ctf-university-2024-clouded/image-15.png width=562 height=150 loading=lazy class=gallery-image data-flex-grow=374 data-flex-basis=899px></p><p>After waiting for a while, the <code>/bin/bash</code> permission was modified into a SUID binary. Now we can obtain root shell by executing <code>/bin/bash -p</code></p><p>root flag obtained!
<img src=/p/htb-ctf-university-2024-clouded/image-16.png width=753 height=124 loading=lazy class=gallery-image data-flex-grow=607 data-flex-basis=1457px></p><p>Flag: HTB{H@ZY_71ME5_AH3AD}</p></section><footer class=article-footer><section class=article-lastmod><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentcolor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<span>Last updated on Dec 18, 2024 16:40 UTC</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Related content</h2><div class=related-content><div class="flex article-list--tile"><article class=has-image><a href=/p/htb-ctf-university-2024-freedom/><div class=article-image><img src=/p/htb-ctf-university-2024-freedom/banner.00f0faa1bd11844f55c6f134be1decef.jpg width=1200 height=630 loading=lazy alt="Featured image of post [HTB CTF University 2024] - Freedom" data-hash="md5-APD6ob0RhE9VxvE0vh3s7w=="></div><div class=article-details><h2 class=article-title>[HTB CTF University 2024] - Freedom</h2></div></a></article><article class=has-image><a href=/p/htb-ctf-university-2024-apolo/><div class=article-image><img src=/p/htb-ctf-university-2024-apolo/banner.da2cf1e91b70b4a07ae27a0719cfe5c0.png width=1005 height=441 loading=lazy alt="Featured image of post [HTB CTF University 2024] - Apolo" data-hash="md5-2izx6RtwtKB64noHGc/lwA=="></div><div class=article-details><h2 class=article-title>[HTB CTF University 2024] - Apolo</h2></div></a></article></div></div></aside><footer class=site-footer><section class=copyright>&copy;
2024 lordrukie</section><section class=powerby>Built with <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Theme <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.29.0>Stack</a></b> designed by <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/ts/main.1e9a3bafd846ced4c345d084b355fb8c7bae75701c338f8a1f8a82c780137826.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>